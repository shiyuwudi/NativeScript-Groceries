"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Created by barney on 2017/6/12.
 */
var core_1 = require("@angular/core");
var store_1 = require("../../shared/store/store"); // 数据模型
var store_home_service_1 = require("../../shared/store/store-home.service");
var page_1 = require("tns-core-modules/ui/page");
var color_1 = require("color");
var router_1 = require("@angular/router");
var StoreComponent = (function () {
    function StoreComponent(storeHomeService, page, router) {
        this.storeHomeService = storeHomeService;
        this.page = page;
        this.router = router;
        this.dataAry = []; // 数据源
        this.filterTitle = ["店铺首页", "全部宝贝", "新品上架", "联系客服"];
        this.selectedIndex = 0;
        this.selectedIndexSmall = 0;
        this.storeName = "";
        this.storeLogo = "";
        this.storeFans = "";
        this.fav = false; // 收藏状态 默认未收藏
        this.allGoodsCount = "";
        this.newCount = "";
        this.allGoodsHidden = false;
        this.allGoodsFilterAry = [];
        this.goodsOrderType = "goods_click"; // 全部宝贝-默认“人气”
    }
    StoreComponent.prototype.ngOnInit = function () {
        this.page.backgroundColor = new color_1.Color("#f0f0f0");
        this.getStoreInfo();
        this.getStoreHomeList();
        this.allGoodsFilterAry = ["人气", "销量", "价格", "新品"];
    };
    // 店铺首页列表
    StoreComponent.prototype.getStoreHomeList = function () {
        var _this = this;
        this.storeHomeService.getStoreHomeList({ store_id: "13" }).subscribe(function (json) {
            var ary = [];
            json.goods_data.forEach(function (store) {
                store.data[0].name = store.name; // 向数组的第一个元素添加 name 属性，实现分组效果
                if (!!store.data[1]) {
                    store.data[1].index = false;
                }
                if (store.data.length % 2 !== 0) {
                    store.data.push({}); // 若数组的个数为奇数，则追加一个空的元素，实现换行效果
                }
                store.data.forEach(function (goods) {
                    ary.push(goods); // 把各组的所有元素拼接为一个总的数组
                });
            });
            ary.map(function (goods) {
                new store_1.StoreHomeGoods(goods.goods_current_price, goods.goods_main_photo, goods.goods_name, goods.id, goods.name, null);
            });
            _this.dataAry = ary;
        });
    };
    // 新品上架列表
    StoreComponent.prototype.getNewGoodsList = function () {
        var _this = this;
        this.storeHomeService.getNewGoodsList({ store_id: "12" }).subscribe(function (json) {
            var ary = [];
            json.data.forEach(function (store) {
                store.goods_data[0].date_data = store.date_data; // 向数组的第一个元素添加 name 属性，实现分组效果
                if (store.goods_data.length % 2 !== 0) {
                    store.goods_data.push({}); // 若数组的个数为奇数，则追加一个空的元素，实现换行效果
                }
                store.goods_data.forEach(function (goods) {
                    ary.push(goods); // 把各组的所有元素拼接为一个总的数组
                });
            });
            ary.map(function (goods) {
                new store_1.StoreHomeGoods(goods.goods_current_price, goods.goods_main_photo, goods.goods_name, goods.id, null, goods.date_data);
            });
            _this.dataAry = ary;
        });
    };
    // 全部宝贝列表
    StoreComponent.prototype.getAllGoods = function () {
        var _this = this;
        this.storeHomeService.getAllGoodsList({ store_id: "12", orderBy: this.goodsOrderType, orderType: "" }).subscribe(function (json) {
            var ary = [];
            json.goods_list.forEach(function (store) {
                ary.push(new store_1.StoreHomeGoods(store.goods_current_price, store.goods_main_photo, store.goods_name, store.id, null, null));
            });
            _this.dataAry = ary;
        });
    };
    // 获取店铺信息
    StoreComponent.prototype.getStoreInfo = function () {
        var _this = this;
        this.storeHomeService.getStoreInfo({ store_id: "12" }).subscribe(function (json) {
            //    this.storeInfoModel = new StoreInfo(json.fans_count, json.favourited, json.store_logo, json.store_name, json.new_count, json.all_count);
            _this.storeName = json.store_name;
            _this.storeLogo = json.store_logo;
            _this.storeFans = json.fans_count;
            _this.allGoodsCount = json.all_count;
            _this.newCount = json.new_count;
            if (json.favourited === "0") {
                _this.fav = false;
            }
            else {
                _this.fav = true;
            }
        });
    };
    // 四个大选项点击事件
    StoreComponent.prototype.onTap = function (index) {
        this.selectedIndex = index;
        if (index === 0) {
            this.getStoreHomeList();
            this.allGoodsHidden = false;
        }
        else if (index === 2) {
            this.getNewGoodsList();
            this.allGoodsHidden = false;
        }
        else if (index === 1) {
            this.getAllGoods();
            this.allGoodsHidden = true;
        }
        else if (index === 3) {
            // 跳转联系客服页面
            this.allGoodsHidden = false;
        }
    };
    // 四个小选项点击事件
    StoreComponent.prototype.onTapSmall = function (index) {
        this.selectedIndexSmall = index;
        if (index === 0) {
            this.goodsOrderType = "goods_click";
            this.getAllGoods();
        }
        else if (index === 1) {
            this.goodsOrderType = "goods_salenum";
            this.getAllGoods();
        }
        else if (index === 2) {
            this.goodsOrderType = "goods_current_price";
            this.getAllGoods();
        }
        else if (index === 3) {
            this.goodsOrderType = "goods_seller_time";
            this.getAllGoods();
        }
    };
    // 点击收藏按钮
    StoreComponent.prototype.isFavourite = function () {
        var _this = this;
        this.storeHomeService.isFavourite({ store_id: "12" }).subscribe(function (json) {
            if (json.code === 1) {
                alert("操作失败");
            }
            else if (json.code === 0) {
                if (_this.fav === false) {
                    alert("收藏成功");
                    _this.fav = true;
                }
                else {
                    alert("取消收藏成功");
                    _this.fav = false;
                }
            }
        });
    };
    // 跳转分类页面
    StoreComponent.prototype.jumpClassify = function () {
        // this.router.navigate(["/store-classify"]);
    };
    return StoreComponent;
}());
StoreComponent = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: "store",
        templateUrl: "./store.component.html",
        styleUrls: ["./store-common.css"],
        providers: [store_home_service_1.StoreHomeService],
    }),
    __metadata("design:paramtypes", [store_home_service_1.StoreHomeService, page_1.Page, router_1.Router])
], StoreComponent);
exports.StoreComponent = StoreComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RvcmUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCxzQ0FBa0Q7QUFDbEQsa0RBQXFFLENBQUMsT0FBTztBQUM3RSw0RUFBeUU7QUFDekUsaURBQThDO0FBQzlDLCtCQUE4QjtBQUM5QiwwQ0FBeUM7QUFTekMsSUFBYSxjQUFjO0lBZXZCLHdCQUFvQixnQkFBa0MsRUFBVSxJQUFVLEVBQVUsTUFBYztRQUE5RSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFkMUYsWUFBTyxHQUFxQixFQUFFLENBQUMsQ0FBQyxNQUFNO1FBQ3RDLGdCQUFXLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMvQyxrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUNsQix1QkFBa0IsR0FBRyxDQUFDLENBQUM7UUFDdkIsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixjQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2YsUUFBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLGFBQWE7UUFDMUIsa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFDbkIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLHNCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUN2QixtQkFBYyxHQUFHLGFBQWEsQ0FBQyxDQUFDLGNBQWM7SUFFK0MsQ0FBQztJQUN0RyxpQ0FBUSxHQUFSO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxhQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDakQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUks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LENBQUM7WUFDbEIsQ0FBQztZQUFBLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxHQUFHLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFDckIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNkLEtBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDO2dCQUNwQixDQUFDO2dCQUFBLElBQUksQ0FBQyxDQUFDO29CQUNGLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDakIsS0FBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQ3JCLENBQUM7WUFDTCxDQUFDO1FBQ0osQ0FBQyxDQUNKLENBQUM7SUFDZCxDQUFDO0lBQ0QsU0FBUztJQUNULHFDQUFZLEdBQVo7UUFDSSw2Q0FBNkM7SUFDakQsQ0FBQztJQUNMLHFCQUFDO0FBQUQsQ0FBQyxBQWpLRCxJQWlLQztBQWpLWSxjQUFjO0lBUDFCLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLHdCQUF3QjtRQUNyQyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQztRQUNqQyxTQUFTLEVBQUUsQ0FBQyxxQ0FBZ0IsQ0FBQztLQUNoQyxDQUFDO3FDQWdCd0MscUNBQWdCLEVBQWdCLFdBQUksRUFBa0IsZUFBTTtHQWZ6RixjQUFjLENBaUsxQjtBQWpLWSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBiYXJuZXkgb24gMjAxNy82LzEyLlxuICovXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBTdG9yZUhvbWUsIFN0b3JlSG9tZUdvb2RzIH0gZnJvbSBcIi4uLy4uL3NoYXJlZC9zdG9yZS9zdG9yZVwiOyAvLyDmlbDmja7mqKHlnotcbmltcG9ydCB7IFN0b3JlSG9tZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL3N0b3JlL3N0b3JlLWhvbWUuc2VydmljZVwiO1xuaW1wb3J0IHtQYWdlfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9wYWdlXCI7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gXCJjb2xvclwiO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuXG5AQ29tcG9uZW50KHtcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHNlbGVjdG9yOiBcInN0b3JlXCIsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9zdG9yZS5jb21wb25lbnQuaHRtbFwiLFxuICAgIHN0eWxlVXJsczogW1wiLi9zdG9yZS1jb21tb24uY3NzXCJdLFxuICAgIHByb3ZpZGVyczogW1N0b3JlSG9tZVNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBTdG9yZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHJpdmF0ZSBkYXRhQXJ5OiBTdG9yZUhvbWVHb29kc1tdID0gW107IC8vIOaVsOaNrua6kFxuICAgIHByaXZhdGUgZmlsdGVyVGl0bGUgPSBbXCLlupfpk7rpppbpobVcIiwgXCLlhajpg6jlrp3otJ1cIiwgXCLmlrDlk4HkuIrmnrZcIiwgXCLogZTns7vlrqLmnI1cIl07XG4gICAgcHJpdmF0ZSBzZWxlY3RlZEluZGV4ID0gMDtcbiAgICBwcml2YXRlIHNlbGVjdGVkSW5kZXhTbWFsbCA9IDA7XG4gICAgcHJpdmF0ZSBzdG9yZU5hbWUgPSBcIlwiO1xuICAgIHByaXZhdGUgc3RvcmVMb2dvID0gXCJcIjtcbiAgICBwcml2YXRlIHN0b3JlRmFucyA9IFwiXCI7XG4gICAgcHJpdmF0ZSBmYXYgPSBmYWxzZTsgLy8g5pS26JeP54q25oCBIOm7mOiupOacquaUtuiXj1xuICAgIHByaXZhdGUgYWxsR29vZHNDb3VudCA9IFwiXCI7XG4gICAgcHJpdmF0ZSBuZXdDb3VudCA9IFwiXCI7XG4gICAgcHJpdmF0ZSBhbGxHb29kc0hpZGRlbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgYWxsR29vZHNGaWx0ZXJBcnkgPSBbXTtcbiAgICBwcml2YXRlIGdvb2RzT3JkZXJUeXBlID0gXCJnb29kc19jbGlja1wiOyAvLyDlhajpg6jlrp3otJ0t6buY6K6k4oCc5Lq65rCU4oCdXG4gICAgXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzdG9yZUhvbWVTZXJ2aWNlOiBTdG9yZUhvbWVTZXJ2aWNlLCBwcml2YXRlIHBhZ2U6IFBhZ2UsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIpIHt9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMucGFnZS5iYWNrZ3JvdW5kQ29sb3IgPSBuZXcgQ29sb3IoXCIjZjBmMGYwXCIpO1xuICAgICAgICB0aGlzLmdldFN0b3JlSW5mbygpO1xuICAgICAgICB0aGlzLmdldFN0b3JlSG9tZUxpc3QoKTtcbiAgICAgICAgdGhpcy5hbGxHb29kc0ZpbHRlckFyeSA9IFtcIuS6uuawlFwiLCBcIumUgOmHj1wiLCBcIuS7t+agvFwiLCBcIuaWsOWTgVwiXTtcbiAgICB9XG4gICAgLy8g5bqX6ZO66aaW6aG15YiX6KGoXG4gICAgZ2V0U3RvcmVIb21lTGlzdCgpIHtcbiAgICAgICAgdGhpcy5zdG9yZUhvbWVTZXJ2aWNlLmdldFN0b3JlSG9tZUxpc3Qoe3N0b3JlX2lkOiBcIjEzXCJ9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChqc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnkgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZ29vZHNfZGF0YS5mb3JFYWNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdG9yZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmRhdGFbMF0ubmFtZSA9IHN0b3JlLm5hbWU7IC8vIOWQkeaVsOe7hOeahOesrOS4gOS4quWFg+e0oOa3u+WKoCBuYW1lIOWxnuaAp++8jOWunueOsOWIhue7hOaViOaenFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXN0b3JlLmRhdGFbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGF0YVsxXS5pbmRleCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmUuZGF0YS5sZW5ndGggJSAyICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmRhdGEucHVzaCh7fSk7IC8vIOiLpeaVsOe7hOeahOS4quaVsOS4uuWlh+aVsO+8jOWImei/veWKoOS4gOS4quepuueahOWFg+e0oO+8jOWunueOsOaNouihjOaViOaenFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5kYXRhLmZvckVhY2goKGdvb2RzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyeS5wdXNoKGdvb2RzKTsgLy8g5oqK5ZCE57uE55qE5omA5pyJ5YWD57Sg5ou85o6l5Li65LiA5Liq5oC755qE5pWw57uEXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnkubWFwKChnb29kcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBTdG9yZUhvbWVHb29kcyhnb29kcy5nb29kc19jdXJyZW50X3ByaWNlLCBnb29kcy5nb29kc19tYWluX3Bob3RvLCBnb29kcy5nb29kc19uYW1lLCBnb29kcy5pZCwgZ29vZHMubmFtZSxudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhQXJ5ID0gYXJ5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g5paw5ZOB5LiK5p625YiX6KGoXG4gICAgZ2V0TmV3R29vZHNMaXN0KCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuZ2V0TmV3R29vZHNMaXN0KHtzdG9yZV9pZDogXCIxMlwifSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAoanNvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJ5ID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBqc29uLmRhdGEuZm9yRWFjaChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RvcmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5nb29kc19kYXRhWzBdLmRhdGVfZGF0YSA9IHN0b3JlLmRhdGVfZGF0YTsgLy8g5ZCR5pWw57uE55qE56ys5LiA5Liq5YWD57Sg5re75YqgIG5hbWUg5bGe5oCn77yM5a6e546w5YiG57uE5pWI5p6cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3JlLmdvb2RzX2RhdGEubGVuZ3RoICUgMiAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5nb29kc19kYXRhLnB1c2goe30pOyAvLyDoi6XmlbDnu4TnmoTkuKrmlbDkuLrlpYfmlbDvvIzliJnov73liqDkuIDkuKrnqbrnmoTlhYPntKDvvIzlrp7njrDmjaLooYzmlYjmnpxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZ29vZHNfZGF0YS5mb3JFYWNoKChnb29kcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnkucHVzaChnb29kcyk7IC8vIOaKiuWQhOe7hOeahOaJgOacieWFg+e0oOaLvOaOpeS4uuS4gOS4quaAu+eahOaVsOe7hFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJ5Lm1hcCgoZ29vZHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgU3RvcmVIb21lR29vZHMoZ29vZHMuZ29vZHNfY3VycmVudF9wcmljZSwgZ29vZHMuZ29vZHNfbWFpbl9waG90bywgZ29vZHMuZ29vZHNfbmFtZSwgZ29vZHMuaWQsIG51bGwsIGdvb2RzLmRhdGVfZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YUFyeSA9IGFyeTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgfVxuICAgIC8vIOWFqOmDqOWunei0neWIl+ihqFxuICAgIGdldEFsbEdvb2RzKCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuZ2V0QWxsR29vZHNMaXN0KHtzdG9yZV9pZDogXCIxMlwiLCBvcmRlckJ5OiB0aGlzLmdvb2RzT3JkZXJUeXBlLCBvcmRlclR5cGU6IFwiXCJ9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChqc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnkgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpzb24uZ29vZHNfbGlzdC5mb3JFYWNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdG9yZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyeS5wdXNoKG5ldyBTdG9yZUhvbWVHb29kcyhzdG9yZS5nb29kc19jdXJyZW50X3ByaWNlLCBzdG9yZS5nb29kc19tYWluX3Bob3RvLCBzdG9yZS5nb29kc19uYW1lLCBzdG9yZS5pZCwgbnVsbCwgbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhQXJ5ID0gYXJ5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g6I635Y+W5bqX6ZO65L+h5oGvXG4gICAgZ2V0U3RvcmVJbmZvKCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuZ2V0U3RvcmVJbmZvKHtzdG9yZV9pZDogXCIxMlwifSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAoanNvbikgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHRoaXMuc3RvcmVJbmZvTW9kZWwgPSBuZXcgU3RvcmVJbmZvKGpzb24uZmFuc19jb3VudCwganNvbi5mYXZvdXJpdGVkLCBqc29uLnN0b3JlX2xvZ28sIGpzb24uc3RvcmVfbmFtZSwganNvbi5uZXdfY291bnQsIGpzb24uYWxsX2NvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZU5hbWUgPSBqc29uLnN0b3JlX25hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVMb2dvID0ganNvbi5zdG9yZV9sb2dvO1xuICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlRmFucyA9IGpzb24uZmFuc19jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGxHb29kc0NvdW50ID0ganNvbi5hbGxfY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV3Q291bnQgPSBqc29uLm5ld19jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uZmF2b3VyaXRlZCA9PT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g5Zub5Liq5aSn6YCJ6aG554K55Ye75LqL5Lu2XG4gICAgb25UYXAoaW5kZXgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5nZXRTdG9yZUhvbWVMaXN0KCk7XG4gICAgICAgICAgICB0aGlzLmFsbEdvb2RzSGlkZGVuID0gZmFsc2U7XG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAyKSB7XG4gICAgICAgICAgICB0aGlzLmdldE5ld0dvb2RzTGlzdCgpO1xuICAgICAgICAgICAgdGhpcy5hbGxHb29kc0hpZGRlbiA9IGZhbHNlO1xuICAgICAgICB9ZWxzZSBpZihpbmRleCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxHb29kcygpO1xuICAgICAgICAgICAgdGhpcy5hbGxHb29kc0hpZGRlbiA9IHRydWU7XG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAzKSB7XG4gICAgICAgICAgICAvLyDot7PovazogZTns7vlrqLmnI3pobXpnaJcbiAgICAgICAgICAgIHRoaXMuYWxsR29vZHNIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyDlm5vkuKrlsI/pgInpobnngrnlh7vkuovku7ZcbiAgICBvblRhcFNtYWxsKGluZGV4KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleFNtYWxsID0gaW5kZXg7XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5nb29kc09yZGVyVHlwZSA9IFwiZ29vZHNfY2xpY2tcIjtcbiAgICAgICAgICAgIHRoaXMuZ2V0QWxsR29vZHMoKTsgICAgICAgICAgICBcbiAgICAgICAgfWVsc2UgaWYoaW5kZXggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuZ29vZHNPcmRlclR5cGUgPSBcImdvb2RzX3NhbGVudW1cIjtcbiAgICAgICAgICAgIHRoaXMuZ2V0QWxsR29vZHMoKTsgICAgICAgICAgIFxuICAgICAgICB9ZWxzZSBpZihpbmRleCA9PT0gMikge1xuICAgICAgICAgICAgdGhpcy5nb29kc09yZGVyVHlwZSA9IFwiZ29vZHNfY3VycmVudF9wcmljZVwiO1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxHb29kcygpOyAgICAgICAgICAgXG4gICAgICAgIH1lbHNlIGlmKGluZGV4ID09PSAzKSB7XG4gICAgICAgICAgICB0aGlzLmdvb2RzT3JkZXJUeXBlID0gXCJnb29kc19zZWxsZXJfdGltZVwiO1xuICAgICAgICAgICAgdGhpcy5nZXRBbGxHb29kcygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIOeCueWHu+aUtuiXj+aMiemSrlxuICAgIGlzRmF2b3VyaXRlKCkge1xuICAgICAgICB0aGlzLnN0b3JlSG9tZVNlcnZpY2UuaXNGYXZvdXJpdGUoe3N0b3JlX2lkOiBcIjEyXCJ9KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChqc29uKSA9PiB7ICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uY29kZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLmk43kvZzlpLHotKVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKGpzb24uY29kZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmF2ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwi5pS26JeP5oiQ5YqfXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmF2ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLlj5bmtojmlLbol4/miJDlip9cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXYgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgLy8g6Lez6L2s5YiG57G76aG16Z2iXG4gICAganVtcENsYXNzaWZ5KCkge1xuICAgICAgICAvLyB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvc3RvcmUtY2xhc3NpZnlcIl0pO1xuICAgIH1cbn0iXX0=